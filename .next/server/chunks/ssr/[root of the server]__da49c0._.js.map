{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/LENOVO/Desktop/allProject/habibiParts-main/app/store/ProductDetailClient.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { createClientComponentClient } from \"@supabase/auth-helpers-nextjs\";\r\nimport { useRouter } from 'next/navigation';\r\nimport { FunContext } from '../context/Context';\r\n\r\ninterface Product {\r\n  id: string;\r\n  imag: string;\r\n  title: string;\r\n  model: string;\r\n  price: number;\r\n  description?: string;\r\n  stars: number;\r\n  order?: number;\r\n}\r\n\r\n// تعریف نوع آیتم سبد خرید\r\ninterface CartItem {\r\n  id: string;\r\n  title: string;\r\n  price: number;\r\n  quantity: number;\r\n  image: string;\r\n}\r\n\r\nexport default function ProductDetailClient({ params }: { params: { productId: string } }) {\r\n    const { getQty, handleQty, deHandleQty } = FunContext();\r\n  \r\n  const [product, setProduct] = useState<Product | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [quantity, setQuantity] = useState(1);\r\n  const [cart, setCart] = useState<CartItem[]>([]);\r\n  const router = useRouter();\r\n  const supabase = createClientComponentClient();\r\n\r\n  useEffect(() => {\r\n    fetchProduct();\r\n    // بارگیری سبد خرید از localStorage هنگام لود صفحه\r\n    const savedCart = localStorage.getItem('cart');\r\n    if (savedCart) {\r\n      setCart(JSON.parse(savedCart));\r\n    }\r\n  }, [params.productId]);\r\n\r\n  const fetchProduct = async () => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      const { data, error: supabaseError } = await supabase\r\n        .from('Habibi')\r\n        .select('*')\r\n        .eq('id', params.productId)\r\n        .single();\r\n\r\n      if (supabaseError) {\r\n        throw new Error('خطا در دریافت اطلاعات از سرور: ' + supabaseError.message);\r\n      }\r\n\r\n      if (!data) {\r\n        throw new Error('محصولی با این شناسه در جدول Habibi یافت نشد');\r\n      }\r\n\r\n      setProduct(data);\r\n    } catch (err: unknown) {\r\n      setError(err instanceof Error ? err.message : 'خطای ناشناخته در دریافت اطلاعات محصول');\r\n      console.error('جزئیات خطا:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleQuantityChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const value = parseInt(e.target.value) || 1;\r\n    setQuantity(Math.max(1, Math.min(10, value)));\r\n  };\r\n\r\n  // افزودن یا افزایش محصول به سبد خرید\r\n  const addToCart = () => {\r\n    if (!product) return;\r\n\r\n    const existingItemIndex = cart.findIndex(item => item.id === product.id);\r\n\r\n    if (existingItemIndex >= 0) {\r\n      // اگر محصول در سبد وجود دارد، تعداد را افزایش می‌دهیم\r\n      const updatedCart = [...cart];\r\n      updatedCart[existingItemIndex].quantity += quantity;\r\n      setCart(updatedCart);\r\n      localStorage.setItem('cart', JSON.stringify(updatedCart));\r\n    } else {\r\n      // اگر محصول در سبد نیست، جدید اضافه می‌کنیم\r\n      const newItem: CartItem = {\r\n        id: product.id,\r\n        title: product.title,\r\n        price: product.price,\r\n        quantity: quantity,\r\n        image: product.imag\r\n      };\r\n      const updatedCart = [...cart, newItem];\r\n      setCart(updatedCart);\r\n      localStorage.setItem('cart', JSON.stringify(updatedCart));\r\n    }\r\n\r\n    alert(`${quantity} عدد ${product.title} به سبد خرید اضافه شد`);\r\n  };\r\n\r\n  // کاهش تعداد یک آیتم در سبد خرید\r\n  const decreaseQuantity = (id: string) => {\r\n    const updatedCart = cart.map(item => {\r\n      if (item.id === id && item.quantity > 1) {\r\n        item.quantity--;\r\n      }\r\n      return item;\r\n    }).filter(item => item.quantity > 0); // حذف آیتم‌های با تعداد ۰\r\n\r\n    setCart(updatedCart);\r\n    localStorage.setItem('cart', JSON.stringify(updatedCart));\r\n  };\r\n\r\n  // محاسبه تعداد کل آیتم‌های سبد خرید\r\n  const totalCartItems = cart.reduce((total, item) => total + item.quantity, 0);\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"p-4 text-center\">\r\n        <div className=\"animate-pulse flex flex-col items-center space-y-4\">\r\n          <div className=\"w-full h-64 bg-gray-200 rounded\"></div>\r\n          <div className=\"w-3/4 h-6 bg-gray-200 rounded\"></div>\r\n          <div className=\"w-1/2 h-6 bg-gray-200 rounded\"></div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"p-4 max-w-md mx-auto text-center\">\r\n        <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded\">\r\n          {error}\r\n        </div>\r\n        <button\r\n          onClick={() => router.push('/')}\r\n          className=\"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600\"\r\n        >\r\n          بازگشت به صفحه اصلی\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!product) {\r\n    return <div className=\"p-4 text-center\">محصولی یافت نشد</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 max-w-6xl mx-auto\">\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n        {/* بخش تصویر محصول */}\r\n        <div className=\"bg-gray-50 rounded-lg overflow-hidden shadow-md\">\r\n          {product.imag ? (\r\n            <img\r\n              src={product.imag}\r\n              alt={product.title}\r\n              className=\"w-full h-auto object-contain max-h-96\"\r\n              onError={(e) => {\r\n                const target = e.target as HTMLImageElement;\r\n                target.src = '/placeholder-product.png';\r\n              }}\r\n            />\r\n          ) : (\r\n            <div className=\"w-full h-96 flex items-center justify-center bg-gray-100 text-gray-400\">\r\n              تصویری موجود نیست\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* بخش اطلاعات محصول */}\r\n        <div dir=\"rtl\" className=\"space-y-6\">\r\n          <h1 className=\"text-2xl md:text-3xl font-bold text-gray-800\">{product.title}</h1>\r\n          {product.model && <p className=\"text-lg text-gray-600 mt-2\">{product.model}</p>}\r\n\r\n          <div className=\"flex items-center\">\r\n            {product.stars && (\r\n              <div className=\"flex items-center text-yellow-400\">\r\n                {[...Array(5)].map((_, i) => (\r\n                  <svg\r\n                    key={i}\r\n                    className={`w-5 h-5 ${i < product.stars ? 'fill-current' : 'stroke-current fill-none'}`}\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path d=\"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z\" />\r\n                  </svg>\r\n                ))}\r\n              </div>\r\n            )}\r\n            {product.order && (\r\n              <span className=\"text-sm text-gray-500 mr-2\">({product.order} سفارش)</span>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"py-4 border-t border-b border-gray-200\">\r\n            <div className=\"text-2xl font-semibold text-blue-600\">\r\n              {product.price?.toLocaleString('fa-IR')} تومان\r\n            </div>\r\n          </div>\r\n\r\n          {product.description && (\r\n            <div className=\"pt-4\">\r\n              <h2 className=\"text-lg font-semibold mb-3 text-gray-800\">توضیحات محصول</h2>\r\n              <p className=\"text-gray-700 whitespace-pre-line\">{product.description}</p>\r\n            </div>\r\n          )}\r\n\r\n<div className=\"flex items-center gap-2 mt-2\">\r\n                    <button\r\n                      className=\"w-6 h-6 bg-blue-500 rounded-sm text-white text-center\"\r\n                      onClick={(e) => {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        handleQty(Number(product.id));\r\n                      }}\r\n                    >\r\n                      +\r\n                    </button>\r\n                    <span>{getQty(Number(product.id))}</span>\r\n                    <button\r\n                      className=\"w-6 h-6 bg-red-500 rounded-sm text-white text-center\"\r\n                      onClick={(e) => {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        deHandleQty(Number(product.id));\r\n                      }}\r\n                    >\r\n                      -\r\n                    </button>\r\n                  </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n  \r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 447, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}